<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Credit Risk Analysis Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .header { text-align: center; border-bottom: 3px solid #2c3e50; padding-bottom: 15px; margin-bottom: 25px; }
        .section { margin-bottom: 30px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .section-title { background-color: #2c3e50; color: white; padding: 10px; margin: -15px -15px 15px -15px; border-radius: 3px; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f8f9fa; font-weight: bold; }
        .risk-high { background-color: #ffebee; color: #c62828; font-weight: bold; }
        .risk-medium { background-color: #fff3e0; color: #ef6c00; }
        .risk-low { background-color: #e8f5e8; color: #2e7d32; }
        .llm-summary { background-color: #e3f2fd; padding: 15px; border-left: 4px solid #2196f3; margin: 15px 0; }
        .score-card { text-align: center; padding: 20px; margin: 10px; border-radius: 8px; }
        .score-excellent { background-color: #e8f5e8; border: 2px solid #4caf50; }
        .score-good { background-color: #e3f2fd; border: 2px solid #2196f3; }
        .score-fair { background-color: #fff3e0; border: 2px solid #ff9800; }
        .score-poor { background-color: #ffebee; border: 2px solid #f44336; }
        .footer { margin-top: 40px; text-align: center; font-size: 12px; color: #666; border-top: 1px solid #ddd; padding-top: 15px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Credit Risk Analysis Report</h1>
        <h3>Application #{{ application.id }}</h3>
        <p>Generated on: {{ generated_date }}</p>
    </div>

    <!-- Applicant Information -->
    <div class="section">
        <div class="section-title">Applicant Information</div>
        <table>
            <tr><th>Field</th><th>Value</th></tr>
            <tr><td>Application ID</td><td>{{ application.id }}</td></tr>
            <tr><td>Applicant Name</td><td>{{ application.first_name }} {{ application.last_name }}</td></tr>
            <tr><td>PAN Number</td><td>{{ application.pan_number }}</td></tr>
            <tr><td>Aadhar Number</td><td>{{ application.aadhar_number }}</td></tr>
            <tr><td>Monthly Salary</td><td>â‚¹{{ "{:,.2f}".format(application.monthly_salary) }}</td></tr>
            <tr><td>Existing EMI</td><td>â‚¹{{ "{:,.2f}".format(application.existing_emi) }}</td></tr>
        </table>
    </div>

    <!-- Credit Score Summary -->
    <div class="section">
        <div class="section-title">Credit Score Analysis</div>
        <div class="score-card {% if application.cibil_score >= 750 %}score-excellent{% elif application.cibil_score >= 650 %}score-good{% elif application.cibil_score >= 550 %}score-fair{% else %}score-poor{% endif %}">
            <h2>CIBIL Score</h2>
            <h1 style="font-size: 48px; margin: 10px 0;">{{ application.cibil_score }}</h1>
            <h3>
                {% if application.cibil_score >= 750 %}
                EXCELLENT
                {% elif application.cibil_score >= 650 %}
                GOOD
                {% elif application.cibil_score >= 550 %}
                FAIR
                {% else %}
                POOR
                {% endif %}
            </h3>
        </div>
        
        <table>
            <tr><th>Score Range</th><th>Rating</th><th>Risk Level</th></tr>
            <tr><td>750 - 900</td><td>Excellent</td><td class="risk-low">Low Risk</td></tr>
            <tr><td>650 - 749</td><td>Good</td><td class="risk-low">Low Risk</td></tr>
            <tr><td>550 - 649</td><td>Fair</td><td class="risk-medium">Medium Risk</td></tr>
            <tr><td>300 - 549</td><td>Poor</td><td class="risk-high">High Risk</td></tr>
        </table>
    </div>

    <!-- Financial Health Analysis -->
    <div class="section">
        <div class="section-title">Financial Health Analysis</div>
        {% set debt_to_income = (application.existing_emi / application.monthly_salary * 100) if application.monthly_salary > 0 else 100 %}
        {% set affordability = ((application.monthly_salary - application.existing_emi) / application.monthly_salary * 100) if application.monthly_salary > 0 else 0 %}
        
        <table>
            <tr><th>Financial Metric</th><th>Value</th><th>Status</th><th>Benchmark</th></tr>
            <tr>
                <td>Debt-to-Income Ratio</td>
                <td>{{ "%.1f"|format(debt_to_income) }}%</td>
                <td class="{% if debt_to_income <= 30 %}risk-low{% elif debt_to_income <= 50 %}risk-medium{% else %}risk-high{% endif %}">
                    {% if debt_to_income <= 30 %}Healthy
                    {% elif debt_to_income <= 50 %}Moderate
                    {% else %}Concerning
                    {% endif %}
                </td>
                <td>&lt; 30% (Ideal)</td>
            </tr>
            <tr>
                <td>Monthly Affordability</td>
                <td>{{ "%.1f"|format(affordability) }}%</td>
                <td class="{% if affordability >= 70 %}risk-low{% elif affordability >= 50 %}risk-medium{% else %}risk-high{% endif %}">
                    {% if affordability >= 70 %}Strong
                    {% elif affordability >= 50 %}Adequate
                    {% else %}Weak
                    {% endif %}
                </td>
                <td>&gt; 70% (Ideal)</td>
            </tr>
            <tr>
                <td>Loan-to-Income Ratio</td>
                <td>{{ "%.1f"|format((application.loan_amount / application.monthly_salary) if application.monthly_salary > 0 else 0) }}</td>
                <td>-</td>
                <td>&lt; 60 (Recommended)</td>
            </tr>
        </table>
    </div>

    <!-- LLM Credit Risk Summary -->
    <div class="section">
        <div class="section-title">AI Credit Risk Assessment</div>
        <div class="llm-summary">
            <h4>ðŸ¤– AI Risk Analysis Summary:</h4>
            <p><strong>{{ llm_summary.overall_assessment }}</strong></p>
            <p>{{ llm_summary.detailed_analysis }}</p>
            
            <h5>Key Risk Factors:</h5>
            <ul>
                {% for factor in llm_summary.key_factors %}
                <li>{{ factor }}</li>
                {% endfor %}
            </ul>
            
            <h5>Recommendations:</h5>
            <ul>
                {% for recommendation in llm_summary.recommendations %}
                <li>{{ recommendation }}</li>
                {% endfor %}
            </ul>
            
            <p><strong>Confidence Level:</strong> {{ llm_summary.confidence_level }}</p>
        </div>
    </div>

    <!-- Risk Indicators -->
    <div class="section">
        <div class="section-title">Risk Indicators</div>
        <table>
            <tr><th>Indicator</th><th>Status</th><th>Impact</th></tr>
            <tr>
                <td>Credit History Quality</td>
                <td>
                    {% if application.cibil_score >= 750 %}Excellent
                    {% elif application.cibil_score >= 650 %}Good
                    {% elif application.cibil_score >= 550 %}Fair
                    {% else %}Poor
                    {% endif %}
                </td>
                <td class="{% if application.cibil_score >= 750 %}risk-low{% elif application.cibil_score >= 650 %}risk-low{% elif application.cibil_score >= 550 %}risk-medium{% else %}risk-high{% endif %}">
                    {% if application.cibil_score >= 750 %}Low
                    {% elif application.cibil_score >= 650 %}Low
                    {% elif application.cibil_score >= 550 %}Medium
                    {% else %}High
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td>Debt Burden</td>
                <td>
                    {% if debt_to_income <= 30 %}Low
                    {% elif debt_to_income <= 50 %}Moderate
                    {% else %}High
                    {% endif %}
                </td>
                <td class="{% if debt_to_income <= 30 %}risk-low{% elif debt_to_income <= 50 %}risk-medium{% else %}risk-high{% endif %}">
                    {% if debt_to_income <= 30 %}Low
                    {% elif debt_to_income <= 50 %}Medium
                    {% else %}High
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td>Income Stability</td>
                <td>
                    {% if application.monthly_salary >= 50000 %}Stable
                    {% else %}Moderate
                    {% endif %}
                </td>
                <td class="{% if application.monthly_salary >= 50000 %}risk-low{% else %}risk-medium{% endif %}">
                    {% if application.monthly_salary >= 50000 %}Low
                    {% else %}Medium
                    {% endif %}
                </td>
            </tr>
        </table>
    </div>

    <div class="footer">
        <p>This credit risk report was generated by AI-powered analysis system</p>
        <p>Report ID: CR-{{ application.id }}-{{ timestamp }}</p>
        <p>Confidential - For Internal Use Only</p>
    </div>
</body>
</html>