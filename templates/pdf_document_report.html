<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Document Verification Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .header { text-align: center; border-bottom: 3px solid #2c3e50; padding-bottom: 15px; margin-bottom: 25px; }
        .section { margin-bottom: 30px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .section-title { background-color: #2c3e50; color: white; padding: 10px; margin: -15px -15px 15px -15px; border-radius: 3px; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f8f9fa; font-weight: bold; }
        .status-verified { background-color: #e8f5e8; color: #2e7d32; }
        .status-pending { background-color: #fff3e0; color: #ef6c00; }
        .status-missing { background-color: #ffebee; color: #c62828; }
        .status-review { background-color: #e3f2fd; color: #1565c0; }
        .llm-summary { background-color: #e3f2fd; padding: 15px; border-left: 4px solid #2196f3; margin: 15px 0; }
        .risk-high { background-color: #ffebee; color: #c62828; font-weight: bold; }
        .risk-medium { background-color: #fff3e0; color: #ef6c00; }
        .risk-low { background-color: #e8f5e8; color: #2e7d32; }
        .document-card { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .footer { margin-top: 40px; text-align: center; font-size: 12px; color: #666; border-top: 1px solid #ddd; padding-top: 15px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Document Verification Report</h1>
        <h3>Application #{{ application.id }}</h3>
        <p>Generated on: {{ generated_date }}</p>
    </div>

    <!-- Document Verification Summary -->
    <div class="section">
        <div class="section-title">Document Verification Summary</div>
        
        <div style="display: flex; justify-content: space-around; text-align: center; margin: 20px 0;">
            <div>
                <h3>Total Documents</h3>
                <h2>{{ documents|length }}</h2>
            </div>
            <div>
                <h3>Verified</h3>
                <h2 style="color: #2e7d32;">{{ documents|selectattr('status', 'equalto', 'VERIFIED')|list|length }}</h2>
            </div>
            <div>
                <h3>Pending</h3>
                <h2 style="color: #ef6c00;">{{ documents|selectattr('status', 'equalto', 'PENDING')|list|length }}</h2>
            </div>
            <div>
                <h3>Missing</h3>
                <h2 style="color: #c62828;">{{ documents|selectattr('status', 'equalto', 'MISSING')|list|length }}</h2>
            </div>
        </div>

        <table>
            <tr>
                <th>Document Type</th>
                <th>Status</th>
                <th>Risk Level</th>
                <th>Verification Date</th>
                <th>Issues Found</th>
            </tr>
            {% for doc in documents %}
            <tr>
                <td>{{ doc.document_type }}</td>
                <td class="status-{{ doc.status|lower }}">
                    {{ doc.status }}
                </td>
                <td class="risk-{{ doc.risk_level|lower }}">
                    {{ doc.risk_level }}
                </td>
                <td>{{ doc.verified_date if doc.verified_date else 'N/A' }}</td>
                <td>
                    {% if doc.issues %}
                        {{ doc.issues|join(', ') }}
                    {% else %}
                        None
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <!-- Detailed Document Analysis -->
    <div class="section">
        <div class="section-title">Detailed Document Analysis</div>
        
        {% for doc in documents %}
        <div class="document-card">
            <h4>{{ doc.document_type }}</h4>
            <table>
                <tr><td style="width: 30%;"><strong>Verification Status:</strong></td>
                    <td class="status-{{ doc.status|lower }}">{{ doc.status }}</td></tr>
                <tr><td><strong>Risk Assessment:</strong></td>
                    <td class="risk-{{ doc.risk_level|lower }}">{{ doc.risk_level }} Risk</td></tr>
                <tr><td><strong>AI Confidence:</strong></td>
                    <td>{{ "%.1f"|format(doc.ai_confidence * 100) }}%</td></tr>
                <tr><td><strong>Verification Method:</strong></td>
                    <td>{{ doc.verification_method }}</td></tr>
                {% if doc.verification_details %}
                <tr><td><strong>Details:</strong></td><td>{{ doc.verification_details }}</td></tr>
                {% endif %}
            </table>
        </div>
        {% endfor %}
    </div>

    <!-- LLM Document Analysis Summary -->
    <div class="section">
        <div class="section-title">AI Document Verification Summary</div>
        <div class="llm-summary">
            <h4>ðŸ¤– AI Document Analysis:</h4>
            <p><strong>{{ llm_summary.overall_assessment }}</strong></p>
            <p>{{ llm_summary.detailed_analysis }}</p>
            
            <h5>Key Findings:</h5>
            <ul>
                {% for finding in llm_summary.key_findings %}
                <li>{{ finding }}</li>
                {% endfor %}
            </ul>
            
            <h5>Critical Issues:</h5>
            <ul>
                {% if llm_summary.critical_issues %}
                    {% for issue in llm_summary.critical_issues %}
                    <li style="color: #c62828;">{{ issue }}</li>
                    {% endfor %}
                {% else %}
                    <li>No critical issues identified</li>
                {% endif %}
            </ul>
            
            <h5>Recommendations:</h5>
            <ul>
                {% for recommendation in llm_summary.recommendations %}
                <li>{{ recommendation }}</li>
                {% endfor %}
            </ul>
            
            <p><strong>Overall Document Integrity:</strong> {{ llm_summary.integrity_score }}/10</p>
        </div>
    </div>

    <!-- Verification Statistics -->
    <div class="section">
        <div class="section-title">Verification Statistics</div>
        <table>
            <tr><th>Metric</th><th>Value</th><th>Benchmark</th></tr>
            <tr><td>Overall Verification Rate</td>
                <td>{{ "%.1f"|format((documents|selectattr('status', 'equalto', 'VERIFIED')|list|length / documents|length * 100)) }}%</td>
                <td>&gt; 90%</td></tr>
            <tr><td>Average Risk Score</td>
                <td>{{ "%.1f"|format(documents|map(attribute='risk_score')|sum / documents|length) }}</td>
                <td>&lt; 30</td></tr>
            <tr><td>AI Confidence Average</td>
                <td>{{ "%.1f"|format((documents|map(attribute='ai_confidence')|sum / documents|length * 100)) }}%</td>
                <td>&gt; 85%</td></tr>
        </table>
    </div>

    <div class="footer">
        <p>This document verification report was generated by AI-powered analysis system</p>
        <p>Report ID: DOC-{{ application.id }}-{{ timestamp }}</p>
        <p>Confidential - For Internal Use Only</p>
    </div>
</body>
</html>